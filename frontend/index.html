fetch('/verify_token', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ token: token })
})
.then(res => res.json())
.then(data => {
if (data.status !== 'success') {
localStorage.removeItem('authToken');
window.location.href = '/login';
}
});
}

function logout() {
localStorage.removeItem('authToken');
localStorage.removeItem('userName');
localStorage.removeItem('userBranch');
window.location.href = '/login';
}
</script>
</head>

<body>

    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <div class="toggle-track">
            <div class="toggle-thumb">
                <span class="toggle-icon">☀️</span>
            </div>
        </div>
    </div>

    <!-- Selection Screen -->
    <div id="selection-screen">
        <div class="split-half black" onclick="selectType('FWD')">
            <span>FWD</span>
        </div>
        <div class="split-half white" onclick="selectType('RTO')">
            <span>RTO</span>
        </div>
    </div>

    <!-- Scanning Screen -->
    <div id="scanning-screen" class="hidden">
        <div class="header">
            <button class="back-btn" onclick="resetToSelection()">← Back</button>
            <div style="text-align: center; flex: 1; display: contents;">
                <h1 id="mode-title">FWD</h1>
            </div>

            <!-- Profile Menu -->
            <div class="profile-menu">
                <div class="profile-icon" onclick="toggleProfileMenu()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="8" r="4" />
                        <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
                    </svg>
                </div>
                <div id="profile-dropdown" class="profile-dropdown hidden">
                    <div class="profile-info">
                        <div class="profile-name" id="dropdown-user-name"></div>
                        <div class="profile-branch" id="dropdown-user-branch"></div>
                    </div>
                    <button class="logout-btn" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div id="status-area" class="status hidden"></div>

        <div class="step-indicator">
            <h2 id="current-instruction">Scan Bin QR</h2>
        </div>

        <div id="reader"></div>

        <div id="manual-entry">
            <input type="text" id="manual-input" placeholder="Scan or Enter ID...">
            <button onclick="handleManualInput()">Submit</button>
        </div>

        <!-- Change Bin Button -->
        <button id="change-bin-btn" class="change-bin-btn-full hidden" onclick="changeBin()">Change Bin</button>

        <!-- Recent Scans History -->
        <div id="recent-scans" class="recent-scans hidden">
            <h3>Recent Scans</h3>
            <div id="scans-list"></div>
        </div>
    </div>
    <!-- Custom Confirmation Modal -->
    <div id="confirm-modal" class="modal hidden">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <h3 class="modal-title">Delete Scan?</h3>
            <p class="modal-message" id="modal-message"></p>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-cancel" id="modal-no">No</button>
                <button class="modal-btn modal-btn-confirm" id="modal-yes">Yes</button>
            </div>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>

</html><!-- Download Button -->
<div class="download-btn" onclick="showDownloadModal()">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
    </svg>
</div>

<!-- Download Modal -->
<div id="download-modal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <h3 class="modal-title">Download Scan Data</h3>
        <div class="date-inputs">
            <div class="date-input-group">
                <label for="start-date">From Date</label>
                <input type="date" id="start-date" class="date-input">
            </div>
            <div class="date-input-group">
                <label for="end-date">To Date</label>
                <input type="date" id="end-date" class="date-input">
            </div>
        </div>
        <p class="date-range-hint">Maximum 7-day range allowed</p>
        <div class="modal-buttons">
            <button class="modal-btn modal-btn-cancel" onclick="closeDownloadModal()">Cancel</button>
            <button class="modal-btn modal-btn-confirm" onclick="handleDownload()">Download</button>
        </div>
    </div>
</div>