<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bag Tracker</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <script>
        // Auth check - redirect to login if not authenticated
        const token = localStorage.getItem('authToken');
        if (!token) {
            window.location.href = '/login';
        } else {
            // Verify token
            fetch('/verify_token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: token })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.status !== 'success') {
                        localStorage.removeItem('authToken');
                        window.location.href = '/login';
                    }
                });
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userName');
            localStorage.removeItem('userBranch');
            window.location.href = '/login';
        }
    </script>
</head>
<span>FWD</span>
</div>
<div class="split-half white" onclick="selectType('RTO')">
    <span>RTO</span>
    <circle cx="12" cy="8" r="4" />
    <path d="M6 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" />
    </svg>
</div>
<div id="profile-dropdown" class="profile-dropdown hidden">
    <div class="profile-info">
        <div class="profile-name" id="dropdown-user-name"></div>
        <div class="profile-branch" id="dropdown-user-branch"></div>
    </div>
    <button class="logout-btn" onclick="logout()">Logout</button>
</div>
</div>
</div>

<div id="status-area" class="status hidden"></div>

<div class="step-indicator">
    <h2 id="current-instruction">Scan Bin QR</h2>
</div>

<div id="reader"></div>

<div id="manual-entry">
    <input type="text" id="manual-input" placeholder="Scan or Enter ID...">
    <button onclick="handleManualInput()">Submit</button>
</div>

<!-- Recent Scans History -->
<div id="recent-scans" class="recent-scans hidden">
    <h3>Recent Scans</h3>
    <div id="scans-list"></div>
</div>
</div>

<script src="/static/script.js"></script>
</body>

</html>