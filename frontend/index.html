<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bag Tracker</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <script>
        // Auth check - redirect to login if not authenticated
        const token = localStorage.getItem('authToken');
        if (!token) {
            window.location.href = '/login';
        } else {
            // Verify token
            fetch('/verify_token', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: token })
            })
                .then(res => res.json())
                .then(data => {
                    if (data.status !== 'success') {
                        localStorage.removeItem('authToken');
                        window.location.href = '/login';
                    } else {
                        // Display user info
                        const userName = localStorage.getItem('userName') || data.user.name;
                        const userBranch = localStorage.getItem('userBranch') || data.user.branch;
                        document.addEventListener('DOMContentLoaded', () => {
                            const userInfo = document.getElementById('user-info');
                            if (userInfo) {
                                userInfo.textContent = `${userName} | ${userBranch}`;
                            }
                        });
                    }
                });
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userName');
            localStorage.removeItem('userBranch');
            window.location.href = '/login';
        }
    </script>
</head>

<body>

    <!-- Theme Toggle -->
    <div class="theme-toggle" onclick="toggleTheme()">
        <div class="toggle-track">
            <div class="toggle-thumb">
                <span class="toggle-icon">☀️</span>
            </div>
        </div>
    </div>

    <!-- Selection Screen -->
    <div id="selection-screen">
        <div class="split-half black" onclick="selectType('FWD')">
            <span>FWD</span>
        </div>

        <div id="reader"></div>

        <div id="manual-entry">
            <input type="text" id="manual-input" placeholder="Scan or Enter ID...">
            <button onclick="handleManualInput()">Submit</button>
        </div>

        <!-- Recent Scans History -->
        <div id="recent-scans" class="recent-scans hidden">
            <h3>Recent Scans</h3>
            <div id="scans-list"></div>
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>

</html>